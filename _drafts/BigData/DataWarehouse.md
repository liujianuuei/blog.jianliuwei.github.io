# 数据仓库

**出现背景**

数据仓库的发展历史可以追溯到上世纪70年代。

**解决问题**

数据仓库的目的是解决"数据分析"的诉求，相比于"数据事务"即增删改查，主要解决数据的"多维查询"。

## 数仓分层

**一般分层原理**

分层的目的是"解耦"和"复用"。

**一般分层实践**

一般分为 ODS、DWD、DWS、ADS 四层，再加 DIM/维表。具体怎么分因公司而异。

**一般各层职能**

ODS 完全保留原始数据。DWD 负责自下而上模型建设，要包含全部"明细数据"，以及指向各个维度的外键值。DWS 负责自上而下模型建设，至少要发生"纵向聚合"或者"横向聚合"。ADS 不需建模按需定制化加工即可。DIM 是对具体分析实体的分析角度。

## 数仓分域

**分域原则**

①按业务过程分；②按业务系统分；③按分析场景分；一般分两级即可。

**分域举例**

经营、风控、分发、Offer、授信、用信、信审、客服、催收、用户。具体比如：

```
————经营
    |————决策
    |————动作
    |————权益
    |————触达
    |————微信
    |————活动
    |————渠道
    |————小满分
    |————开放平台
    |————名单
————风控
    |————贷前
    |————贷后
    |————外部数据
————分发/机构
    |————分发决策
    |————机构额度
    |————机构价格
    |————助贷资金
    |————助贷管理
————Offer
    |————额度
    |————价格
————授信
    |————授信
    |————增信
————交易/用信
    |————交易
    |————OMG
    |————借据-核心
    |————分期-核心
    |————账户-核心
————信审
    |————信审
————客服
    |————客服
————催收
    |————催收
————用户
    |————用户行为
    |————用户设备
    |————用户组件
    |————用户ID
```

**分域实践**

ODS 一般不涉及分域。DWD 按照业务过程或者业务系统从下而上分域。DWS 按照分析场景从上而下分域。ADS 一般没必要分域。DIM 按照业务过程或者业务系统从下而上分域。

注：出于简单考虑，DWS 和 DWD（包括 DIM） 也有时候共用一套分域规则。

## 数仓建模

**维度建模**

对比"关系/ER建模"（也叫范式建模）——指的是对 DW* 进行建模。一般可分为如下几步：

一、确定业务过程或业务场景——位于业务全景的哪一块——重要

二、确定实体或粒度或主键——明确定义事实表里的“一行”代表什么业务含义——非常重要————\[谁\]

三、确定维度也就是关联维度表的维度——可能涉及维度退化———————————————\[何时何地\]

四、确定业务事实信息——按需添加————————————————————————————\[发生什么\]



